Функция ЗначенияПоУмолчаниюТипов()
	Типы = Новый Структура;
	
	Типы.Вставить("Строка", "");
	Типы.Вставить("Число", 0);
	Типы.Вставить("Дата", Неопределено);
	Типы.Вставить("Булево", Неопределено);
	
	Возврат Типы;
КонецФункции

Функция ПреобразоватьЗначений(Значение, ТипЗначения) Экспорт
    // Получаем значения по умолчанию
    ЗначенияПоУмолчанию = ЗначенияПоУмолчаниюТипов();
    
    // Проверяем, есть ли указанный тип в структуре
    Если НЕ ЗначенияПоУмолчанию.Свойство(ТипЗначения) Тогда
        ВызватьИсключение "Указан неподдерживаемый тип: " + ТипЗначения;
    КонецЕсли;
    
    // Если значение не определено, возвращаем значение по умолчанию
    Если Значение = Неопределено Тогда
        Возврат ЗначенияПоУмолчанию[ТипЗначения];
    КонецЕсли;
    
    // Проверяем текущий тип значения
    ТекущийТип = ТипЗнч(Значение);
    
    // Преобразование в зависимости от целевого типа
    Если ТипЗначения = "Строка" Тогда
        Если ТекущийТип = Тип("Строка") Тогда
            Возврат Значение;
        Иначе
            Попытка
                Возврат Строка(Значение);
            Исключение
                Возврат ЗначенияПоУмолчанию.Строка;
            КонецПопытки;
        КонецЕсли;
        
    ИначеЕсли ТипЗначения = "Число" Тогда
        Если ТекущийТип = Тип("Число") Тогда
            Возврат Формат(Значение, "ЧГ=0");
        Иначе
            Попытка
                Возврат Формат(Число(Значение), "ЧГ=0");
            Исключение
                Возврат ЗначенияПоУмолчанию.Число;
            КонецПопытки;
        КонецЕсли;
        
    ИначеЕсли ТипЗначения = "Дата" Тогда
        Если ТекущийТип = Тип("Дата") Тогда
            Возврат Значение;
        Иначе
            Попытка
                Возврат XMLЗначение(Тип("Дата"), Значение);
            Исключение
                Возврат ЗначенияПоУмолчанию.Дата;
            КонецПопытки;
        КонецЕсли;
        
    ИначеЕсли ТипЗначения = "Булево" Тогда
        Если ТекущийТип = Тип("Булево") Тогда
            Возврат Значение;
        Иначе
            Попытка
                Возврат Булево(Значение);
            Исключение
                Возврат ЗначенияПоУмолчанию.Булево;
            КонецПопытки;
        КонецЕсли;
        
    КонецЕсли;
    
    // Если преобразование не удалось, возвращаем значение по умолчанию
    Возврат ЗначенияПоУмолчанию[ТипЗначения];   
	
КонецФункции


#Область ПараметрыОтветов
Функция СформаироватьОтвета(Успех, Вид, ОписаниеОшибки) Экспорт 
	
	СтруктураОтвета = Новый Структура;
	СтруктураОтвета.Вставить("Успех", Успех);
	СтруктураОтвета.Вставить("Вид", Вид);   
	СтруктураОтвета.Вставить("ОписаниеОшибки", ОписаниеОшибки);

	Возврат СтруктураОтвета;    
	
КонецФункции

#КонецОбласти       