//#Область ОписаниеПеременных

//#КонецОбласти

//#Область ОбработчикиСобытийФормы

//&НаКлиенте
//Процедура ПередЗакрытием(Отказ, ЗавершениеРаботы, ТекстПредупреждения, СтандартнаяОбработка)
//	Если ПроверкаЗаполненияПолей() = Ложь Тогда
//		Сообщить("В документе присутствуют незаполненые поля!");
//		Отказ = Истина;
//	КонецЕсли;
//КонецПроцедуры

//&НаКлиенте
//Процедура ПриОткрытии(Отказ)
//	УправлениеИнтерфейсом();
//	НовыйВыводТоваров();
//	Объект.НомерСтраницы = 1; 
//	АктивацияПоляПоиск();
//	//АктивироватьПоиск();
//	//Если Объект.ТекущаяГруппа.Пустая() Тогда
//	//	Элементы.Назад.Доступность = Ложь;
//	//Иначе 
//	//	Элементы.Назад.Доступность = Истина;
//	//КонецЕсли;	
//КонецПроцедуры

//#КонецОбласти

//#Область ОбработчикиСобытийЭлементовШапкиФормы

//&НаСервере
//Функция  ПроверкаЗаполненияПолей()
//	Для Каждого ТМЦ Из Объект.ТЧ Цикл
//		Если ТМЦ.Количество = 0 Тогда
//			Возврат Ложь;
//		ИначеЕсли ТМЦ.Цена = 0 Тогда
//			Возврат Ложь;
//		ИначеЕсли ТМЦ.Сумма = 0 Тогда
//			Возврат Ложь;
//		КонецЕсли;
//	КонецЦикла;
//	
//	Возврат Истина;
//КонецФункции


//&НаСервере
//Функция ДобавитьПустуюСтроку()

//	НоваяСтрока = Объект.ТЧ.Добавить();
//		
//	Возврат НоваяСтрока.ПолучитьИдентификатор();

//КонецФункции // ДобавитьПустуюСтроку()()


//&НаКлиенте
//Процедура УправлениеПанельТоваров()
//	Элементы.ГруппаВыборТовара.Видимость = ПоказатьПанельТоваров; 
//	ПослеЗавершенияПоиска();
//КонецПроцедуры

//#КонецОбласти

//#Область ОбработчикиСобытийЭлементовТаблицыФормыТЧ


//#КонецОбласти

//#Область ОбработчикиКомандФормы

//&НаСервере
//Процедура РассчитатьНаСервере()
//	
//	Продажа = Документы.Продажи.СоздатьДокумент();
//	Продажа.Дата = Объект.Дата;
//	Продажа.СкладРеализации = ПодготовкаДанных.ОсновнойСклад(Перечисления.ТипСклада.ОПТ);
//	Продажа.СуммаПродажи = Объект.ТЧ.Итог("Сумма");
//	Для Каждого Товар Из Объект.ТЧ Цикл
//		Если НЕ Товар.Номенклатура.Пустая() Тогда
//			Если Товар.Количество > 0 Тогда
//				ТМЦ = Продажа.ТЧ.Добавить();
//				ТМЦ.ТМЦ = Товар.Номенклатура;
//				ТМЦ.Количество = Товар.Количество;
//				ТМЦ.Цена = Товар.Цена;
//				ТМЦ.Сумма = Товар.Сумма;
//			КонецЕсли;
//			
//		КонецЕсли;
//	КонецЦикла;
//	
//	Продажа.Записать(РежимЗаписиДокумента.Проведение,РежимПроведенияДокумента.Оперативный);
//	
//	Объект.ТЧ.Очистить();
//	
//КонецПроцедуры

//&НаКлиенте
//Процедура Рассчитать(Команда)
//	РассчитатьНаСервере();
//	ФормированиеТЗПродажи();  
//	Предупреждение("Продажа успешно завершена!",5); 

//КонецПроцедуры

//&НаКлиенте
//Процедура ОтчетПоДню(Команда)
//	ПарамОтчета = Новый Структура;
//	ПарамОтчета.Вставить("НачалоПериода",ТекущаяДата());
//	ПарамОтчета.Вставить("КонецПериода",КонецДня(ТекущаяДата()));
//	ОткрытьФорму("Отчет.Продажи.Форма",ПарамОтчета);
//КонецПроцедуры

//&НаСервере
//Функция УстановкаРодителяГруппы()

//	Объект.ТекущаяГруппа = Объект.ТекущаяГруппа.Родитель;
//	
//КонецФункции // ПолучитьРодителяГруппы()


//&НаКлиенте
//Процедура Назад(Команда)
//	ОчиститьПанельТоваров();
//	ОбновитьНастройкиОтображенияПанелиТоваров(Команда.Имя);
//	//Объект.НомерСтраницы = 1;

//	//УстановкаРодителяГруппы();
//	НовыйВыводТоваров();
//    АктивацияПоляПоиск();
//КонецПроцедуры

//&НаКлиенте
//Процедура CледущаяСтраница(Команда)
//	КолТовараВГруппе =КоличествоСтраниц();
//	Если КолТовараВГруппе < НомерСтраницы + 1 Тогда
//		Возврат;
//	КонецЕсли;
//	ОбновитьНастройкиОтображенияПанелиТоваров(Команда.Имя);
//	ОсновнаяПроцедура();
//	//НовыйВыводТоваров(); 
//	АктивацияПоляПоиск();    
//	
//КонецПроцедуры

//&НаКлиенте
//Процедура ПредыдущаяСтраница(Команда)
//	Если Объект.НомерСтраницы = 1 Тогда
//		Возврат;
//	КонецЕсли;
//	ОчиститьПанельТоваров();

//	Объект.НомерСтраницы = Объект.НомерСтраницы - 1;
//	НовыйВыводТоваров();
//    АктивацияПоляПоиск();
//КонецПроцедуры

//&НаКлиенте
//Процедура ЗавершитьРаботу(Команда)
//	ЗавершитьРаботуСистемы(Ложь); 
//КонецПроцедуры

//&НаСервере
//Процедура УдалитьНаСервере()
//	Объект.ТЧ.Очистить();
//КонецПроцедуры

//&НаКлиенте
//Процедура Удалить(Команда)
//	УдалитьНаСервере();
//КонецПроцедуры

//#КонецОбласти

//#Область СлужебныеПроцедурыИФункции

//&НаСервере
//Процедура УдалитьПустуюСтроку(ИД)
//	
//	Объект.ТЧ.Удалить(ИД);
//	
//КонецПроцедуры // УУдалитьПустуюСтроку()


//&НаСервере
//Процедура ДобавитьНаСервере(ИмяКоманды,ЗаголовоКоманды,Группа)
//	
//	//Добавление команды формы
//	Команда = Команды.Добавить(
//		ИмяКоманды); //Имя команды
//	Команда.Заголовок = ЗаголовоКоманды;
//	Команда.Действие  = "КомандаДобавитьТовар"; //Имя связанной процедуры
//	
//	//Полный перечень свойств команды в синтакс-помощнике
//	//	Интерфейс (управляемый)->Форма клиентского приложения->КомандаФормы
//	
//	//Добавление кнопки формы
//	КнопкаФормы = Элементы.Добавить(
//		"Кнопка"+ИмяКоманды, //Имя кнопки
//		Тип("КнопкаФормы"),             //Тип, всегда КнопкаФормы
//		Элементы.ГруппаВыборТовара);                      //Контейнер для кнопки (Форма, Группа, Командная панель)
//		
//	КнопкаФормы.ИмяКоманды = ИмяКоманды; //Связь с командой по имени
//	
//	//Возможные варианты вида кнопки:
//	//	-Гиперссылка
//	//	-ГиперссылкаКоманднойПанели
//	//	-КнопкаКоманднойПанели
//	//	-ОбычнаяКнопка
//	//Если контейнер для формы - командная панель
//	//то вид кнопки должен быть КнопкаКоманднойПанели
//	КнопкаФормы.Вид = ВидКнопкиФормы.ОбычнаяКнопка; 
//	Если Группа = Истина Тогда
//		КнопкаФормы.ЦветФона = Метаданные.ЭлементыСтиля.ЦветКнопкиГруппы.Значение;
//	КонецЕсли;
//	//КнопкаФормы.ЦветФона.Зеленый = 236;
//	//КнопкаФормы.ЦветФона.Красный = 255;
//	//КнопкаФормы.ЦветФона.Синий = 139;
//	//КнопкаФормы.Шрифт
//	//КнопкаФормы.Ширина
//	//Полный перечень свойств кнопки формы в синтакс-помощнике
//	//	Интерфейс (управляемый)->Кнопка формы
//		
//	// Вставить содержимое обработчика.
//КонецПроцедуры

//&НаКлиенте
//Процедура УправлениеИнтерфейсом()

//	УправлениеПанельТоваров();	

//КонецПроцедуры // УправлениеИнтерфейсом()

//&НаСервере
//Процедура ФормированиеТЗПродажи()

//	ТЗ_СодержимогоЧека = Новый ТаблицаЗначений;
//	ТЗ_СодержимогоЧека.Колонки.Добавить("Номенклатура");      
//	ТЗ_СодержимогоЧека.Колонки.Добавить("ФОП");
//	ТЗ_СодержимогоЧека.Колонки.Добавить("УКТЗЕД");
//	ТЗ_СодержимогоЧека.Колонки.Добавить("НалоговаяГруппа");
//	ТЗ_СодержимогоЧека.Колонки.Добавить("Количество", Новый ОписаниеТипов("Число"));
//	ТЗ_СодержимогоЧека.Колонки.Добавить("Цена", Новый ОписаниеТипов("Число"));
//	ТЗ_СодержимогоЧека.Колонки.Добавить("Сумма", Новый ОписаниеТипов("Число"));

//	Для Каждого Данные Из Объект.ТЧ Цикл
//		НоваяСтрока = ТЗ_СодержимогоЧека.Добавить();
//		НоваяСтрока.Номенклатура    = Данные.Номенклатура;
//		НоваяСтрока.УКТЗЕД          = Данные.Номенклатура.УКТЗЕТ;
//		НоваяСтрока.ФОП             = Данные.Номенклатура.ФОП;
//		НоваяСтрока.НалоговаяГруппа = Данные.Номенклатура.НалоговаяГруппа;
//		НоваяСтрока.Количество      = Данные.Количество;
//		НоваяСтрока.Цена            = Данные.Цена;
//		НоваяСтрока.Сумма           = Данные.Сумма;
//	КонецЦикла;         
//	
//	ЧекиПоФОПам = Документы.ФискальнаяПродажа.ПодготовкаТЗПоФОПам(ТЗ_СодержимогоЧека);
//	
//	Для Каждого Элемент Из ЧекиПоФОПам Цикл
//		ФОП = Элемент.Ключ;
//		ТЗ = Элемент.Значение;     
//		
//		Документы.ФискальнаяПродажа.СоздатьДокуменФискальнойПродажи(ТЗ, ФОП, Перечисления.ТипРассчетов.БезнальныйРассчет);	
//	КонецЦикла;

//КонецПроцедуры 

//#КонецОбласти



//#Область УправлениеРедактированиеЧека

//#КонецОбласти       

//#Область УправелниеПоиском

//&НаКлиенте
//Процедура АктивизироватьПолеШтрихкода(ИдентификаторСтроки)
//    Элементы.ТЧ.ТекущаяСтрока = ИдентификаторСтроки;
//    Элементы.ТЧ.ТекущийЭлемент = Элементы.ТЧШтрихКод;          
//	Элементы.ТЧ.ИзменитьСтроку();	
//КонецПроцедуры

//&НаКлиенте
//Процедура УдалитьПоследнююПустуюСтроку()
//    // Проверяем, есть ли строки в табличной части "Товары"
//    Если Объект.ТЧ.Количество() > 0 Тогда
//        // Получаем последнюю строку
//        ПоследняяСтрока = Объект.ТЧ[Объект.ТЧ.Количество() - 1];
//        
//        // Проверяем, заполнено ли поле "Номенклатура" (используем стандартную функцию)
//        Если НЕ ЗначениеЗаполнено(ПоследняяСтрока.Номенклатура) Тогда
//            // Удаляем последнюю строку по индексу
//            Объект.ТЧ.Удалить(Объект.ТЧ.Количество() - 1);
//        КонецЕсли;
//    КонецЕсли;
//КонецПроцедуры



//&НаСервере
//Процедура ДобавитьТМЦбезСтрок(НомерСтрок,Код)   //не использую

//	НайденыйТовар = Справочники.Номенклатура.НайтиПоКоду(Код); 
//	НоменклатураВыбрана(НайденыйТовар, НомерСтрок);

//КонецПроцедуры // ДобавитьТМЦбезСтрок()

//#КонецОбласти      

//#Область ОсновнойФункционал
////поиск из поля поиск штрихкодов
//&НаКлиенте
//Процедура ПолеПоискаТовараПриИзменении(Элемент)
//	
//	Штрихкод = ?(Элемент.Имя = "ПолеПоискаТовара",Число(Элементы.ПолеПоискаТовара.ТекстРедактирования),
//												Число(Элементы.ПолеПоискаТовара2.ТекстРедактирования));

//	Если Штрихкод = 0 Тогда
//		Возврат;
//	КонецЕсли;    
//	
//	ОбработатьПоискТовара(Штрихкод);
//    ПослеЗавершенияПоиска(Элемент.Имя);

//КонецПроцедуры 

////поиск из поля тч штрихкод
//&НаКлиенте
//Процедура ТЧШтрихКодПриИзменении(Элемент) //пока не использую, требует доработки
//	
//	//Штрихкод = Число(Элементы.ПолеПоискаТовара.ТекстРедактирования);
//	//
//	//Если Штрихкод = 0 Тогда
//	//	Возврат;
//	//КонецЕсли;    
//	//
//	//ОбработатьПоискТовара(Штрихкод);
//	////ПослеЗавершенияПоиска();
//	//
//КонецПроцедуры

//&НаКлиенте
//Процедура КомандаДобавитьТовар(Команда)  
//	Код = Число(СтрЗаменить(СтрЗаменить(Команда.Имя,"Код",""),"Группа",""));
//	ЭтоГруппа = ?(СтрНайти(Команда.Имя,"Группа")=0, Ложь, Истина);
//	
//	
//	Если ЭтоГруппа Тогда
//		Группа = ПоискНомеклатурыПоШтрихкоду(Код);
//		ОбновитьДанныеПанелиТоваров(Группа);
//	Иначе
//		ОбработатьПоискТовара(Код);
//	КонецЕсли;
//	
//	ПослеЗавершенияПоиска(); 
//	
//КонецПроцедуры

//#КонецОбласти              

//#Область АктуальныеПроцедурыИФункции

//&НаКлиенте
// Процедура ОбновитьДанныеПанелиТоваров(ВыбранаяГруппа)
// 
// 	ОчиститьПанельТоваров();
//	Объект.ТекущаяГруппа = ВыбранаяГруппа;
//	НовыйВыводТоваров();
// 
// КонецПроцедуры // ОбновитьДанныеПанелиТоваров()
// 
//&НаКлиенте
//Процедура ОбработатьПоискТовара(Штрихкод)    

//	НайденаяНоменклатура = ПоискНомеклатурыПоШтрихкоду(Штрихкод);
//	
//	Если НайденаяНоменклатура = Неопределено Тогда
//		Предупреждение("Товар не найден",2);
//		Возврат;
//	КонецЕсли;
//	
//	ОбработкаНайденогоТовара(НайденаяНоменклатура);
//	
//КонецПроцедуры

//&НаСервере
//Функция ПоискНомеклатурыПоШтрихкоду(Штрихкод)

//	Возврат Справочники.Номенклатура.ГлобальныйПоискПоШтрихКоду(Штрихкод);	

//КонецФункции 

//&НаКлиенте
//Процедура ОбработкаНайденогоТовара(НайденаяНоменклатура)

//	РезультатПоиска = НаличиеТовараВЧеке(НайденаяНоменклатура);
//	//РезультатПоиска = Неопределено;
//	
//	Если РезультатПоиска = Неопределено Тогда //создаем новую строку
//		ИдентификаторСтроки = ДобавитьПустуюСтроку();
//	Иначе
//		ИдентификаторСтроки = РезультатПоиска;
//	КонецЕсли;                
//	
//	//добавляем товар в нужную строку
//	НоменклатураВыбрана(НайденаяНоменклатура, ИдентификаторСтроки);	  

//КонецПроцедуры 

//&НаКлиенте
//Процедура ПослеЗавершенияПоиска(ТекущийАктинвыйЭлементПоиска = "")
//	
//	Если ТекущийАктинвыйЭлементПоиска = "ПолеПоискаТовара" Тогда
//		АктивироватьПоле = Элементы.ПолеПоискаТовара2;   
//	Иначе                                   
//		АктивироватьПоле = Элементы.ПолеПоискаТовара;
//	КонецЕсли;
//	
//	ТекущийЭлемент = АктивироватьПоле;
//	
//	ОчиститьПоляПоиска();
//	
//КонецПроцедуры     

//&НаСервере
//Процедура ОчиститьПоляПоиска()

//	Объект.ПолеПоискаТовара = 0;
//	Объект.ПолеПоискаТовара2 = 0;

//КонецПроцедуры // ОчиститьПоляПоиска()

//&НаСервере
//Функция НаличиеТовараВЧеке(Номенклатура)
//    
//    Если НЕ ПроверкиДанных.ВалидацияВходныхДанных(Номенклатура, "СправочникСсылка.Номенклатура") Тогда
//        Возврат Неопределено;
//    КонецЕсли;
//    
//    ПараметрыПоиска = Новый Структура;
//    ПараметрыПоиска.Вставить("Номенклатура", Номенклатура);
//    
//    РезультатПоиска = Объект.ТЧ.НайтиСтроки(ПараметрыПоиска);

//    Если РезультатПоиска.Количество() = 0 Тогда
//        Возврат Неопределено;
//    КонецЕсли;
//    
//	Идентификатор = РезультатПоиска[0].ПолучитьИдентификатор();	  
//	
//    Возврат Идентификатор;

//КонецФункции


//&НаСервере
//Процедура НоменклатураВыбрана(Номенклатура, ИдентификаторСтроки) 
//	
//    Товар = Объект.ТЧ.НайтиПоИдентификатору(ИдентификаторСтроки);
//	Если НЕ ЗначениеЗаполнено(Товар.Номенклатура) Тогда
//		Товар.Номенклатура = Номенклатура;
//	КонецЕсли;
//	Если НЕ ЗначениеЗаполнено(Товар.Цена) Тогда
//		Товар.Цена = Справочники.Номенклатура.ПолучитьЦенуТовара(Номенклатура);
//	КонецЕсли;
//	Товар.Количество = Товар.Количество + 1;
//	Товар.Сумма = Товар.Цена * Товар.Количество;
//	Если НЕ ЗначениеЗаполнено(Товар.Цена) Тогда
//		Товар.Цена = Справочники.Номенклатура.ПолучитьЦенуТовара(Номенклатура);
//	КонецЕсли;
//	
//	Если НЕ ЗначениеЗаполнено(Товар.ОстатокНаСкладе) Тогда
//		ОстатокТовара = РегистрыНакопления.ОстаткиТоваров.ОстатокТовара(Номенклатура, ПодготовкаДанных.ОсновнойСклад(Перечисления.ТипСклада.ОПТ)); 
//        Если Не ЗначениеЗаполнено(ОстатокТовара) Тогда
//			Товар.ОстатокНаСкладе = 0;
//		Иначе
//			Товар.ОстатокНаСкладе = ОстатокТовара;
//		КонецЕсли;
//	КонецЕсли;
//	
//	Если НЕ ЗначениеЗаполнено(Товар.ШтрихКод) Тогда
//		Товар.ШтрихКод = Справочники.Номенклатура.ШтрихкодНоменклатуры(Номенклатура);
//	КонецЕсли;
//	

//КонецПроцедуры 

//&НаСервере
//Процедура ПересчетСуммы(ИдентификаторСтроки)

//	ТекущаяСтрока = Объект.ТЧ.НайтиПоИдентификатору(ИдентификаторСтроки);
//	ТекущаяСтрока.Сумма = ТекущаяСтрока.Цена * ТекущаяСтрока.Количество;

//КонецПроцедуры // ПересчетСуммы()


//&НаКлиенте
//Процедура ТЧКоличествоПриИзменении(Элемент)
//	ИдентификаторСтроки = Элементы.ТЧ.ТекущаяСтрока;
//	ПересчетСуммы(ИдентификаторСтроки);      
//	АктивацияПоляПоиск();
//КонецПроцедуры

//&НаКлиенте
//Процедура АктивацияПоляПоиск();

//    ОбновитьНастройкиОтображенияПанелиТоваров();
//	ТекущийЭлемент = Элементы.ПолеПоискаТовара;

//КонецПроцедуры


//&НаКлиенте
//Процедура ТЧЦенаПриИзменении(Элемент)
//	ИдентификаторСтроки = Элементы.ТЧ.ТекущаяСтрока;
//	ПересчетСуммы(ИдентификаторСтроки);      
//	АктивацияПоляПоиск();
//КонецПроцедуры
//#КонецОбласти          

//#Область ИнтерфейсВыводаТоваров

//&НаСервере
//Функция ОбновитьИнтерфейс()
//	
//	//следующей страницы или предыдущей страницы не существует
//	Возврат Истина;

//КонецФункции // ОбновитьИнтерфейс()



//&НаКлиенте
//Процедура ОбработкаИзминенияОтображениеИнтерфейса(ИстичникВызова = Неопределено)

//	Если НЕ ОбновитьИнтерфейс() Тогда
//		Возврат;
//	КонецЕсли;
//	
//	ОчиститьПанельТоваров();
//	//создаем нужное количество групп
//	//заполняем группы товарами

//КонецПроцедуры // ОбработкаИзминенияОтображениеИнтерфейса()


//&НаСервере
//Процедура ОбновитьНастройкиОтображенияПанелиТоваров(ДействиеПользователя = Неопределено)
//	
//	//назад           
//	Если ДействиеПользователя = "Назад" Тогда
//		Если ТекущаяГруппа.Пустая() Тогда
//			Возврат;
//		КонецЕсли;
//		НомерСтраницы = 1;
//		ТекущаяГруппа = ТекущаяГруппа.Родитель;
//	КонецЕсли;//страница вперед
//	
//	Если ДействиеПользователя = "ПредыдущаяСтраница" Тогда
//		Если ТекущаяГруппа = 1 Тогда
//			Возврат;
//		КонецЕсли;
//		НомерСтраницы = НомерСтраницы - 1;
//	КонецЕсли;//страница вперед

//	Если ДействиеПользователя = "CледущаяСтраница" Тогда
//		//надо поставить ограничитель для перелистывания больше диапозона
//		//Если ТекущаяГруппа = 1 Тогда
//		//	Возврат;
//		//КонецЕсли;
//		НомерСтраницы = НомерСтраницы + 1;
//	КонецЕсли;//страница вперед

//	//НомерСтраницы = НомерСтраницы + 1;
//	//страница назад
//	//выбор команды товара

//	//первичный вход в панель       
//	Если ДействиеПользователя = Неопределено Тогда
//		НомерСтраницы = 1;
//		ТекущаяГруппа = "";    
//	КонецЕсли;

//КонецПроцедуры

//&НаСервере
//Функция ПолучитьСписокНоменклатурыДляСтраницы(Родитель = Неопределено, НомерСтраницы, КоличествоНаСтраницу)
//	
//	Родитель = ТекущаяГруппа;
//	
//	Запрос = Новый Запрос;
//    Запрос.Текст = 
//        "ВЫБРАТЬ
//        |    Номенклатура.Код КАК Код,
//        |    Номенклатура.Наименование КАК Наименование,
//        |    Номенклатура.НазваниеНаЭтикетке КАК НазваниеЦенни,
//        |    Номенклатура.ЭтоГруппа КАК ЭтоГруппа
//        |ИЗ
//        |    Справочник.Номенклатура КАК Номенклатура
//        |ГДЕ
//        |    Номенклатура.Родитель = &Родитель
//        |    И Номенклатура.ПометкаУдаления = ЛОЖЬ
//        |УПОРЯДОЧИТЬ ПО
//        |    ЭтоГруппа УБЫВ,
//        |    Наименование";
//    
//    Запрос.УстановитьПараметр("Родитель", Родитель);
//    
//    Результат = Запрос.Выполнить().Выбрать();
//    
//    МассивНоменклатуры = Новый Массив;
//    НачалоВывод = (НомерСтраницы - 1) * КоличествоНаСтраницу;
//    Счетчик = 0;
//    ТекущийЭлементКом = 0;
//    
//    Пока Результат.Следующий() Цикл
//        Счетчик = Счетчик + 1;
//        Если Счетчик <= НачалоВывод Тогда Продолжить; КонецЕсли;
//		Если ТекущийЭлементКом >= КоличествоНаСтраницу Тогда 
//			Прервать;
//		КонецЕсли;
//        
//        СтруктураЭлемента = Новый Структура("Код, Наименование, НазваниеЦенни, ЭтоГруппа",
//            Результат.Код, Результат.Наименование, Результат.НазваниеЦенни, Результат.ЭтоГруппа);
//        МассивНоменклатуры.Добавить(СтруктураЭлемента);
//        
//        ТекущийЭлементКом = ТекущийЭлементКом + 1;
//    КонецЦикла;
//    
//    Возврат МассивНоменклатуры; 
//	
//КонецФункции    

//&НаКлиенте
//Процедура АктивизироватьПоиск(Команда)
//	НовыйВыводТоваров();
//КонецПроцедуры

//&НаСервере
//Функция ПолучитьПараметрыПанели()
//    // Здесь можно взять значения из настройки, формы или констант; пока дефолты
//    КоличествоВРяду = 4;  // Кнопок в ряду
//    КоличествоРядов = 6;  // Рядов на странице

//    // Валидация
//	КоличествоВРяду = ?(КоличествоВРяду <= 0, КоличествоВРяду = 4, КоличествоВРяду);
//	КоличествоРядов = ?(КоличествоРядов <= 0, КоличествоРядов = 6, КоличествоРядов);
//    
//    Возврат Новый Структура("КоличествоВРяду, КоличествоРядов", КоличествоВРяду, КоличествоРядов);  
//	
//КонецФункции    

//&НаСервере
//Процедура НовыйВыводТоваров()
//	
//	Родитель = ТекущаяГруппа;
//	
//    ПараметрыПанели = ПолучитьПараметрыПанели();
//    КоличествоВРяду = ПараметрыПанели.КоличествоВРяду;
//    КоличествоРядов = ПараметрыПанели.КоличествоРядов;
//    КоличествоНаСтраницу = КоличествоВРяду * КоличествоРядов;
//    
//    МассивНоменклатуры = ПолучитьСписокНоменклатурыДляСтраницы(Родитель, НомерСтраницы, КоличествоНаСтраницу);
//    
//    Если МассивНоменклатуры.Количество() = 0 Тогда
//        Сообщить("Нет данных для отображения.");
//        Возврат;
//    КонецЕсли;
//    
//    Попытка
//        // Создание динамических групп рядов
//        МассивГруппРядов = Новый Массив;
//        Для ИндексРяда = 0 По КоличествоРядов - 1 Цикл
//            ИмяГруппы = "ГруппаРяд" + Строка(ИндексРяда+1);
//            ГруппаРяда = Элементы.Добавить(ИмяГруппы, Тип("ГруппаФормы"), Элементы.ГруппаВыборТовара);
//            ГруппаРяда.Вид = ВидГруппыФормы.ОбычнаяГруппа;
//            ГруппаРяда.Группировка = ГруппировкаПодчиненныхЭлементовФормы.ГоризонтальнаяВсегда;
//            ГруппаРяда.Ширина = 70;  // Установите нужные свойства
//            ГруппаРяда.Высота = 3;   // Пример высоты
//            МассивГруппРядов.Добавить(ГруппаРяда);
//        КонецЦикла;
//        
//        // Итерация по массиву для создания команд и кнопок
//        СчетчикЭлементов = 0;
//        Для Каждого Элемент Из МассивНоменклатуры Цикл
//            СчетчикЭлементов = СчетчикЭлементов + 1;
//            Если СчетчикЭлементов > КоличествоНаСтраницу Тогда
//                Объект.ИндексПоследнегоНомера = СчетчикЭлементов;
//                Прервать;
//            КонецЕсли;
//            
//            ИмяКоманды = "Код" + Формат(Элемент.Код, "ЧРГ=; ЧГ=0");
//			Если Элемент.ЭтоГруппа Тогда 
//				ИмяКоманды = ИмяКоманды + "Группа"; 
//			КонецЕсли;
//            
//            ЗаголовокКоманды = ?(ПустаяСтрока(Элемент.НазваниеЦенни), Элемент.Наименование, Элемент.НазваниеЦенни);
//            НовыйЗаголовок = Лев(ЗаголовокКоманды, 13) + Символы.ПС + Сред(ЗаголовокКоманды, 14);  // Улучшите форматирование при необходимости
//            
//            Команда = Команды.Добавить(ИмяКоманды);
//            Команда.Заголовок = НовыйЗаголовок;
//            Команда.Действие = "КомандаДобавитьТовар";
//            
//            ИндексРяда = Цел((СчетчикЭлементов - 1) / КоличествоВРяду);
//            ГруппаДляОтображения = МассивГруппРядов[ИндексРяда];
//            
//            КнопкаФормы = Элементы.Добавить("Кнопка" + ИмяКоманды, Тип("КнопкаФормы"), ГруппаДляОтображения);
//            КнопкаФормы.ИмяКоманды = ИмяКоманды;
//            КнопкаФормы.Высота = 3;
//            КнопкаФормы.Ширина = 18;
//            КнопкаФормы.Вид = ВидКнопкиФормы.ОбычнаяКнопка;
//            Если Элемент.ЭтоГруппа Тогда
//                КнопкаФормы.ЦветФона = Метаданные.ЭлементыСтиля.ЦветКнопкиГруппы.Значение;
//                Объект.НомерСтраницы = 1;  // Логика под вопросом, уточните
//            КонецЕсли;
//        КонецЦикла;
//        
//        Элементы.ГруппаВыборТовара.Ширина = 70;
//    Исключение
//        Сообщить("Ошибка при создании элементов: " + ОписаниеОшибки());
//    КонецПопытки;
//КонецПроцедуры

//&НаСервере
//Функция ПолучитьДиапазон()
//    ПараметрыПанели = ПолучитьПараметрыПанели();
//    Возврат (Объект.НомерСтраницы - 1) * (ПараметрыПанели.КоличествоВРяду * ПараметрыПанели.КоличествоРядов);
//КонецФункции

//&НаСервере
//Функция КоличествоСтраниц()
//    ПараметрыПанели = ПолучитьПараметрыПанели();
//    КоличествоНаСтраницу = ПараметрыПанели.КоличествоВРяду * ПараметрыПанели.КоличествоРядов;
//    
//    Запрос = Новый Запрос;
//    Запрос.Текст = "ВЫБРАТЬ КОЛИЧЕСТВО(*) КАК Количество ИЗ Справочник.Номенклатура ГДЕ Родитель = &Родитель И ПометкаУдаления = ЛОЖЬ";
//    Запрос.УстановитьПараметр("Родитель", Объект.ТекущаяГруппа);
//    
//    Результат = Запрос.Выполнить().Выбрать();
//    Если Результат.Следующий() Тогда
//        КолТовара = Результат.Количество;
//        Возврат Цел(КолТовара / КоличествоНаСтраницу) + 1;
//    КонецЕсли;
//    Возврат 1; 
//	
//КонецФункции      


//&НаСервере
//Функция СоздатьГруппыРядов(КоличествоРядов)
//    МассивГруппРядов = Новый Массив;
//    
//	ОчиститьПанельТоваров();
//	
//    Для ИндексРяда = 0 По КоличествоРядов - 1 Цикл
//        ИмяГруппы = "ГруппаРяд" + Строка(ИндексРяда);
//        Попытка
//            ГруппаРяда = Элементы.Добавить(ИмяГруппы, Тип("ГруппаФормы"), Элементы.ГруппаВыборТовара);
//            ГруппаРяда.Вид = ВидГруппыФормы.ОбычнаяГруппа;
//            ГруппаРяда.Группировка = ГруппировкаПодчиненныхЭлементовФормы.ГоризонтальнаяВсегда;
//            ГруппаРяда.Ширина = 70;
//            ГруппаРяда.Высота = 3;
//            МассивГруппРядов.Добавить(ГруппаРяда);
//	    Исключение
//	            Сообщение = Новый СообщениеПользователю;
//	            Сообщение.Текст = "Не удалось создать группу " + ИмяГруппы + ": " + ОписаниеОшибки();
//	            Сообщение.Сообщить();
//	    КонецПопытки;
//    КонецЦикла;
//    
//    Возврат МассивГруппРядов;         
//	
//КонецФункции

//Процедура ЗаполнитьКомандамиИКнопками(МассивНоменклатуры, КоличествоВРяду, КоличествоНаСтраницу, МассивГрупп)
//    // Предполагаем, что МассивГруппРядов уже создан и доступен
//	ОчиститьДинамическиеКоманды();
//	МассивГруппРядов = МассивГрупп;
//    
//    СчетчикЭлементов = 0;
//    Для Каждого Элемент Из МассивНоменклатуры Цикл
//        СчетчикЭлементов = СчетчикЭлементов + 1;
//        Если СчетчикЭлементов > КоличествоНаСтраницу Тогда
//            Объект.ИндексПоследнегоНомера = СчетчикЭлементов;
//            Прервать;
//        КонецЕсли;
//        
//        ИмяКоманды = "Код" + Формат(Элемент.Код, "ЧРГ=; ЧГ=0");
//        Если Элемент.ЭтоГруппа Тогда 
//            ИмяКоманды = ИмяКоманды + "Группа"; 
//        КонецЕсли;
//        
//        ЗаголовокКоманды = ?(ПустаяСтрока(Элемент.НазваниеЦенни), Элемент.Наименование, Элемент.НазваниеЦенни);
//        НовыйЗаголовок = Лев(ЗаголовокКоманды, 13) + Символы.ПС + Сред(ЗаголовокКоманды, 14);  // Улучшите форматирование при необходимости
//        
//        Команда = Команды.Добавить(ИмяКоманды);
//        Команда.Заголовок = НовыйЗаголовок;
//        Команда.Действие = "КомандаДобавитьТовар";
//        
//        ИндексРяда = Цел((СчетчикЭлементов - 1) / КоличествоВРяду);
//        ГруппаДляОтображения = МассивГруппРядов[ИндексРяда];
//        
//        КнопкаФормы = Элементы.Добавить("Кнопка" + ИмяКоманды, Тип("КнопкаФормы"), ГруппаДляОтображения);
//        КнопкаФормы.ИмяКоманды = ИмяКоманды;
//        КнопкаФормы.Высота = 3;
//        КнопкаФормы.Ширина = 18;
//        КнопкаФормы.Вид = ВидКнопкиФормы.ОбычнаяКнопка;
//        Если Элемент.ЭтоГруппа Тогда
//            КнопкаФормы.ЦветФона = Метаданные.ЭлементыСтиля.ЦветКнопкиГруппы.Значение;
//            Объект.НомерСтраницы = 1;  // Логика под вопросом, уточните
//        КонецЕсли;
//    КонецЦикла;
//    
//    Элементы.ГруппаВыборТовара.Ширина = 70;
//КонецПроцедуры

//// Основная процедура, которая вызывает две вышеуказанные
//Процедура ОсновнаяПроцедура()
//    Родитель = ТекущаяГруппа;
//    
//    ПараметрыПанели = ПолучитьПараметрыПанели();
//    КоличествоВРяду = ПараметрыПанели.КоличествоВРяду;
//    КоличествоРядов = ПараметрыПанели.КоличествоРядов;
//    КоличествоНаСтраницу = КоличествоВРяду * КоличествоРядов;
//    
//    МассивНоменклатуры = ПолучитьСписокНоменклатурыДляСтраницы(Родитель, НомерСтраницы, КоличествоНаСтраницу);
//    
//    Если МассивНоменклатуры.Количество() = 0 Тогда
//        Сообщить("Нет данных для отображения.");
//        Возврат;
//    КонецЕсли;
//    
//    Попытка
//        МассивГрупп = СоздатьГруппыРядов(КоличествоРядов);
//        ЗаполнитьКомандамиИКнопками(МассивНоменклатуры, КоличествоВРяду, КоличествоНаСтраницу, МассивГрупп);
//    Исключение
//        Сообщить("Ошибка при создании элементов: " + ОписаниеОшибки());
//    КонецПопытки;
//КонецПроцедуры

//&НаСервере
//Процедура ОчиститьПанельТоваров()
//	
//	ГруппыНаУдаление = Новый Массив;
//	
//	// Очистка существующих элементов в родительской группе
//    Для Каждого Элемент Из Элементы.ГруппаВыборТовара.ПодчиненныеЭлементы Цикл
//		Если Элемент.Имя = "ГруппаУправления" Тогда 
//			Продолжить;
//		КонецЕсли;
//		ГруппыНаУдаление.Добавить(Элемент);
//	КонецЦикла;
//	
//	Для Каждого Группа Из ГруппыНаУдаление Цикл
//		Элементы.Удалить(Группа);
//	КонецЦикла;

//КонецПроцедуры // ОчиститьПанельТоваров()

//&НаСервере
//Процедура ОчиститьДинамическиеКоманды()
//    МассивКУдалениюКоманд = Новый Массив;
//    МассивКУдалениюЭлементов = Новый Массив;
//    
//    // Сначала собираем все динамические элементы (кнопки) для удаления
//    Для Каждого Элемент Из Элементы Цикл
//        Если СтрНачинаетсяС(Элемент.Имя, "КнопкаКод") Тогда
//            МассивКУдалениюЭлементов.Добавить(Элемент);
//        КонецЕсли;
//    КонецЦикла;
//    
//    // Удаляем собранные элементы
//    Для Каждого Элемент Из МассивКУдалениюЭлементов Цикл
//        Элементы.Удалить(Элемент);
//    КонецЦикла;
//    
//    // Теперь собираем динамические команды для удаления
//    Для Каждого Команда Из Команды Цикл
//        Если СтрНачинаетсяС(Команда.Имя, "Код") Тогда
//            МассивКУдалениюКоманд.Добавить(Команда);
//        КонецЕсли;
//    КонецЦикла;
//    
//    // Удаляем собранные команды
//    Для Каждого Команда Из МассивКУдалениюКоманд Цикл
//        Команды.Удалить(Команда);
//	КонецЦикла;
//КонецПроцедуры

//#КонецОбласти       